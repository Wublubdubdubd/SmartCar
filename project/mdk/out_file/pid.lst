C251 COMPILER V5.60.0,  pid                                                                02/05/25  11:30:38  PAGE 1   


C251 COMPILER V5.60.0, COMPILATION OF MODULE pid
OBJECT MODULE PLACED IN .\out_file\pid.obj
COMPILER INVOKED BY: C:\Keil_v5\C251\BIN\C251.EXE ..\user\pid.c LARGE NOALIAS FLOAT64 WARNINGLEVEL(3) OPTIMIZE(2,SIZE) B
                    -ROWSE INCDIR(..\..\libraries\zf_common;..\..\libraries\zf_components;..\..\libraries\zf_device;..\..\libraries\zf_driver
                    -;..\user;..\code) DEBUG PRINT(.\out_file\pid.lst) TABS(2) OBJECT(.\out_file\pid.obj) 

stmt  level    source

    1          #include "pid.h"
    2          
    3          // 角度PID初始化参数
    4          float angle_KP = 2.5, angle_KI = 0,angle_KD = 0.0, angle_IMAX = 20, angle_OUTMAX = 50;
    5          
    6          pid_param_t angle_pid; //角度PID
    7          float angle_target = 0;//角度输入
    8          float angle_error = 0; //角度误差
    9          
   10          float Angle_Pid_fun()
   11          {  
   12   1          //获取当前点到目标点的角度
   13   1          angle_target = get_two_points_azimuth(gps_tau1201.latitude, gps_tau1201.longitude, target_point[0], t
             -arget_point[1]);
   14   1          angle_target -= 180; //修正到yaw的范围  yaw : -180 ~ 180 
   15   1          angle_error = angle_target-yaw;// error :-360 ~ 360
   16   1          //误差修正到 -180~180，即最小的旋转角度
   17   1          if(angle_error > 180) angle_error -= 360;
   18   1          else if(angle_error < -180) angle_error += 360;
   19   1          //角度环
   20   1          PidLocCtrl(&angle_pid,angle_error,0.01);
   21   1        
   22   1          return angle_pid.out;
   23   1      }
   24          
   25          /*******************************************************************************
   26          * 函 数 名         : My_Pid_Init
   27          * 函数功能         : PID初始化 
   28          * 输    入         : 无
   29          * 输    出         : 无
   30          *******************************************************************************/
   31          void My_Pid_Init(void)
   32          {
   33   1          Pid_Param_Init(&angle_pid,angle_KP, angle_KI,angle_KD, angle_IMAX, angle_OUTMAX);
   34   1      }
   35          
   36          
   37          /*******************************************************************************
   38          * 函 数 名         : Pid_Param_Init
   39          * 函数功能         : PID参数初始化 
   40          * 输    入         : imax:积分项最大值
   41          * 输    出         : 无
   42          *******************************************************************************/
   43          void Pid_Param_Init(pid_param_t * pid, float kp, float ki, float kd, float imax, float outmax)
   44          {
   45   1          pid->kp        = kp;
   46   1          pid->ki        = ki;
   47   1          pid->kd        = kd;
   48   1          pid->imax      = imax;
   49   1          pid->out_p     = 0;
   50   1          pid->out_i     = 0;
   51   1          pid->out_d     = 0;
   52   1          pid->out       = 0;
   53   1          pid->outmax    = outmax;
   54   1          pid->integrator= 0;
   55   1          pid->last_error= 0;
   56   1          pid->last_derivative   = 0;
C251 COMPILER V5.60.0,  pid                                                                02/05/25  11:30:38  PAGE 2   

   57   1          pid->last_t    = 0;
   58   1      }
   59          
   60          /*******************************************************************************
   61          * 函 数 名         : PidLocCtrl
   62          * 函数功能     : 位置式PID控制
   63          * 输    入         : pid, error, t
   64          * 输    出         : float
   65          *******************************************************************************/
   66          float PidLocCtrl(pid_param_t * pid, float error, float t)
   67          {
   68   1          /* 累积误差 */
   69   1          pid->integrator += error;
   70   1      
   71   1          /* 误差限幅 */
   72   1          pid->out_i = constrain_float(pid->integrator, -pid->imax, pid->imax);
   73   1      
   74   1      
   75   1          pid->out_p = pid->kp * error;
   76   1          pid->out_i = pid->ki * t * pid->integrator;
   77   1          pid->out_d = pid->kd/t * (error - pid->last_error);
   78   1      
   79   1          pid->last_error = error;
   80   1      
   81   1          pid->out = pid->out_p + pid->out_i + pid->out_d;
   82   1      
   83   1          pid->out = constrain_float(pid->out, -pid->outmax, pid->outmax);
   84   1      
   85   1          return pid->out;
   86   1      }
   87          
   88          
   89          /*******************************************************************************
   90          * 函 数 名         : PidIncCtrl
   91          * 函数功能     : 增量式PID控制
   92          * 输    入         : pid, error, t
   93          * 输    出         : float
   94          *******************************************************************************/
   95          float PidIncCtrl(pid_param_t * pid, float error, float t)
   96          {
   97   1      
   98   1          pid->out_p = pid->kp * (error - pid->last_error);
   99   1          pid->out_i = pid->ki * error * t ;
  100   1          pid->out_d = pid->kd/t * ((error - pid->last_error) - pid->last_derivative);
  101   1      
  102   1          pid->last_derivative = error - pid->last_error;
  103   1          pid->last_error = error;
  104   1      
  105   1          pid->out += pid->out_p + pid->out_i + pid->out_d;
  106   1      
  107   1          pid->out = constrain_float(pid->out, -pid->outmax, pid->outmax);
  108   1          return pid->out;
  109   1      }
  110          
  111          /*******************************************************************************
  112          * 函 数 名         : constrain_float
  113          * 函数功能         : 浮点型数限幅
  114          * 输    入         : amt,low,high
  115          * 输    出         : float
  116          *******************************************************************************/
  117          float constrain_float(float amt, float low, float high)
  118          {
  119   1          return ((amt)<(low)?(low):((amt)>(high)?(high):(amt)));
  120   1      }
  121          
  122          /*******************************************************************************
C251 COMPILER V5.60.0,  pid                                                                02/05/25  11:30:38  PAGE 3   

  123          * 函 数 名         : constrain_short
  124          * 函数功能         : 短整型数限幅
  125          * 输    入         : amt,low,high
  126          * 输    出         : short
  127          *******************************************************************************/
  128          short constrain_short(short amt, short low, short high)
  129          {
  130   1          return ((amt)<(low)?(low):((amt)>(high)?(high):(amt)));
  131   1      }
  132          
  133          /*******************************************************************************
  134          * 函 数 名         : constrain_uint32
  135          * 函数功能         : 限幅
  136          * 输    入         : amt,low,high
  137          * 输    出         : uint32
  138          *******************************************************************************/
  139          unsigned long constrain_uint32(float amt)
  140          {
  141   1          return ((amt)<(0)?(0):((amt)>(max_duty)?(max_duty):(amt)));
  142   1      }


Module Information          Static   Overlayable
------------------------------------------------
  code size            =      2140     ------
  ecode size           =    ------     ------
  data size            =    ------     ------
  idata size           =    ------     ------
  pdata size           =    ------     ------
  xdata size           =       150     ------
  xdata-const size     =    ------     ------
  edata size           =    ------     ------
  bit size             =    ------     ------
  ebit size            =    ------     ------
  bitaddressable size  =    ------     ------
  ebitaddressable size =    ------     ------
  far data size        =    ------     ------
  huge data size       =    ------     ------
  const size           =    ------     ------
  hconst size          =        63     ------
End of Module Information.


C251 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
