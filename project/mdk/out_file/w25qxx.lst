C251 COMPILER V5.60.0,  w25qxx                                                             06/05/25  18:53:49  PAGE 1   


C251 COMPILER V5.60.0, COMPILATION OF MODULE w25qxx
OBJECT MODULE PLACED IN .\out_file\w25qxx.obj
COMPILER INVOKED BY: D:\C251\C251\BIN\C251.EXE ..\user\w25qxx.c LARGE NOALIAS FLOAT64 WARNINGLEVEL(3) OPTIMIZE(2,SIZE) B
                    -ROWSE INCDIR(..\..\libraries\zf_common;..\..\libraries\zf_components;..\..\libraries\zf_device;..\..\libraries\zf_driver
                    -;..\user;..\code) DEBUG PRINT(.\out_file\w25qxx.lst) TABS(2) OBJECT(.\out_file\w25qxx.obj) 

stmt  level    source

    1          #include "config.h"
    2          #include "qspi.h"
    3          #include "w25qxx.h"
    4          #include "bluetooth.h"
    5          
    6          
    7          void W25Q_WriteEnable_06()
    8          {
    9   1          QSPI_WRITE_INSTR(0x06);
   10   1      }
   11          
   12          void W25Q_QPI_WriteEnable_06()
   13          {
   14   1          QSPI_WRITE_QINSTR(0x06);
   15   1      }
   16          
   17          void W25Q_WriteEnableVSR_50()
   18          {
   19   1          QSPI_WRITE_INSTR(0x50);
   20   1      }
   21          
   22          void W25Q_QPI_WriteEnableVSR_50()
   23          {
   24   1          QSPI_WRITE_QINSTR(0x50);
   25   1      }
   26          
   27          void W25Q_WriteDisable_04()
   28          {
   29   1          QSPI_WRITE_INSTR(0x04);
   30   1      }
   31          
   32          void W25Q_QPI_WriteDisable_04()
   33          {
   34   1          QSPI_WRITE_QINSTR(0x04);
   35   1      }
   36          
   37          BYTE W25Q_ReadSR1_05()
   38          {
   39   1          BYTE dat;
   40   1          
   41   1          QSPI_READ_INSTR_SDATA(0x05, (BYTE *)&dat, 1);
   42   1      
   43   1          return dat;
   44   1      }
   45          
   46          void W25Q_WaitBusy(int n)       //自动轮询周期时间单位: us
   47          {
   48   1          while (W25Q_ReadSR1_05() & 0x01);
   49   1      
   50   1          if (n);
   51   1      //    QSPI_POLLING_READ_INSTR_SDATA(0x05, 0x01, 0x00, 12*n);
   52   1      }
   53          
   54          BYTE W25Q_QPI_ReadSR1_05()
   55          {
   56   1          BYTE dat;
   57   1          
C251 COMPILER V5.60.0,  w25qxx                                                             06/05/25  18:53:49  PAGE 2   

   58   1          QSPI_READ_QINSTR_QDATA(0x05, (BYTE *)&dat, 1);
   59   1      
   60   1          return dat;
   61   1      }
   62          
   63          void W25Q_QPI_WaitBusy(int n)
   64          {
   65   1          QSPI_POLLING_READ_QINSTR_QDATA(0x05, 0x01, 0x00, 12*n);
   66   1      }
   67          
   68          BYTE W25Q_ReadSR2_35()
   69          {
   70   1          BYTE dat;
   71   1          
   72   1          QSPI_READ_INSTR_SDATA(0x35, (BYTE *)&dat, 1);
   73   1      
   74   1          return dat;
   75   1      }
   76          
   77          BYTE W25Q_QPI_ReadSR2_35()
   78          {
   79   1          BYTE dat;
   80   1          
   81   1          QSPI_READ_QINSTR_QDATA(0x35, (BYTE *)&dat, 1);
   82   1      
   83   1          return dat;
   84   1      }
   85          
   86          BYTE W25Q_ReadSR3_15()
   87          {
   88   1          BYTE dat;
   89   1          
   90   1          QSPI_READ_INSTR_SDATA(0x15, (BYTE *)&dat, 1);
   91   1      
   92   1          return dat;
   93   1      }
   94          
   95          BYTE W25Q_QPI_ReadSR3_15()
   96          {
   97   1          BYTE dat;
   98   1          
   99   1          QSPI_READ_QINSTR_QDATA(0x15, (BYTE *)&dat, 1);
  100   1      
  101   1          return dat;
  102   1      }
  103          
  104          void W25Q_WriteSR1_01(BYTE dat)
  105          {
  106   1          QSPI_WRITE_INSTR_SADDR8(0x01, dat);
  107   1      }
  108          
  109          void W25Q_WriteSR12_01(WORD dat)
  110          {
  111   1          QSPI_WRITE_INSTR_SADDR16(0x01, dat);    //SR1+SR2合并为16位地址
  112   1      }
  113          
  114          void W25Q_QPI_WriteSR1_01(BYTE dat)
  115          {
  116   1          QSPI_WRITE_QINSTR_QADDR8(0x01, dat);
  117   1      }
  118          
  119          void W25Q_WriteSR2_31(BYTE dat)
  120          {
  121   1          QSPI_WRITE_INSTR_SADDR8(0x31, dat);
  122   1          W25Q_WaitBusy(100);
  123   1      }
C251 COMPILER V5.60.0,  w25qxx                                                             06/05/25  18:53:49  PAGE 3   

  124          
  125          void W25Q_QPI_WriteSR2_31(BYTE dat)
  126          {
  127   1          QSPI_WRITE_QINSTR_QADDR8(0x31, dat);
  128   1      }
  129          
  130          void W25Q_WriteSR3_11(BYTE dat)
  131          {
  132   1          QSPI_WRITE_INSTR_SADDR8(0x11, dat);
  133   1      }
  134          
  135          void W25Q_QPI_WriteSR3_11(BYTE dat)
  136          {
  137   1          QSPI_WRITE_QINSTR_QADDR8(0x11, dat);
  138   1      }
  139          
  140          BYTE W25Q_ReadEAR_C8()
  141          {
  142   1          BYTE dat;
  143   1          
  144   1          QSPI_READ_INSTR_SDATA(0xc8, (BYTE *)&dat, 1);
  145   1      
  146   1          return dat;
  147   1      }
  148          
  149          void W25Q_WriteEAR_C5(BYTE dat)
  150          {
  151   1          QSPI_WRITE_INSTR_SADDR8(0xc5, dat);
  152   1      }
  153          
  154          void W25Q_EnterAddr32Mode_B7()
  155          {
  156   1          QSPI_WRITE_INSTR(0xb7);
  157   1      }
  158          
  159          void W25Q_ExitAddr32Mode_E9()
  160          {
  161   1          QSPI_WRITE_INSTR(0xe9);
  162   1      }
  163          
  164          void W25Q_ReadData_03(DWORD addr, BYTE *pdat, WORD datalen)
  165          {
  166   1          BYTE cnt;
  167   1          
  168   1          while (datalen > 0)
  169   1          {
  170   2              cnt = 32;
  171   2              if (datalen < 32)
  172   2                  cnt = datalen;
  173   2                  
  174   2              QSPI_READ_INSTR_SADDR24_SDATA(0x03, addr, pdat, cnt);
  175   2              
  176   2              datalen -= cnt;
  177   2              addr += cnt;
  178   2              pdat += cnt;
  179   2          }
  180   1      }
  181          
  182          void W25Q_DMA_ReadData_03(DWORD addr, BYTE *pdat, WORD datalen)
  183          {
  184   1          QSPI_DMA_READ_INSTR_SADDR24_SDATA(0x03, addr, pdat, datalen);
  185   1      }
  186          
  187          void W25Q_ReadData_Addr32_13(DWORD addr, BYTE *pdat, WORD datalen)
  188          {
  189   1          BYTE cnt;
C251 COMPILER V5.60.0,  w25qxx                                                             06/05/25  18:53:49  PAGE 4   

  190   1          
  191   1          while (datalen > 0)
  192   1          {
  193   2              cnt = 32;
  194   2              if (datalen < 32)
  195   2                  cnt = datalen;
  196   2                  
  197   2              QSPI_READ_INSTR_SADDR32_SDATA(0x13, addr, pdat, cnt);
  198   2              
  199   2              datalen -= cnt;
  200   2              addr += cnt;
  201   2              pdat += cnt;
  202   2          }
  203   1      }
  204          
  205          void W25Q_DMA_ReadData_Addr32_13(DWORD addr, BYTE *pdat, WORD datalen)
  206          {
  207   1          QSPI_DMA_READ_INSTR_SADDR32_SDATA(0x13, addr, pdat, datalen);
  208   1      }
  209          
  210          void W25Q_FastRead_0B(DWORD addr, BYTE *pdat, WORD datalen)
  211          {
  212   1          BYTE cnt;
  213   1          
  214   1          while (datalen > 0)
  215   1          {
  216   2              cnt = 32;
  217   2              if (datalen < 32)
  218   2                  cnt = datalen;
  219   2                  
  220   2              QSPI_READ_INSTR_SADDR24_DUMMY_SDATA(0x0b, addr, 8, pdat, cnt);
  221   2              
  222   2              datalen -= cnt;
  223   2              addr += cnt;
  224   2              pdat += cnt;
  225   2          }
  226   1      }
  227          
  228          void W25Q_DMA_FastRead_0B(DWORD addr, BYTE *pdat, WORD datalen)
  229          {
  230   1          QSPI_DMA_READ_INSTR_SADDR24_DUMMY_SDATA(0x0b, addr, 8, pdat, datalen);
  231   1      }
  232          
  233          void W25Q_QPI_FastRead_0B(DWORD addr, BYTE *pdat, WORD datalen)
  234          {
  235   1          BYTE cnt;
  236   1          
  237   1          while (datalen > 0)
  238   1          {
  239   2              cnt = 32;
  240   2              if (datalen < 32)
  241   2                  cnt = datalen;
  242   2                  
  243   2              QSPI_READ_QINSTR_QADDR24_DUMMY_QDATA(0x0b, addr, 2, pdat, cnt);
  244   2              
  245   2              datalen -= cnt;
  246   2              addr += cnt;
  247   2              pdat += cnt;
  248   2          }
  249   1      }
  250          
  251          void W25Q_QPI_DMA_FastRead_0B(DWORD addr, BYTE *pdat, WORD datalen)
  252          {
  253   1          QSPI_DMA_READ_QINSTR_QADDR24_DUMMY_QDATA(0x0b, addr, 2, pdat, datalen);
  254   1      }
  255          
C251 COMPILER V5.60.0,  w25qxx                                                             06/05/25  18:53:49  PAGE 5   

  256          void W25Q_FastRead_Addr32_0C(DWORD addr, BYTE *pdat, WORD datalen)
  257          {
  258   1          BYTE cnt;
  259   1          
  260   1          while (datalen > 0)
  261   1          {
  262   2              cnt = 32;
  263   2              if (datalen < 32)
  264   2                  cnt = datalen;
  265   2                  
  266   2              QSPI_READ_INSTR_SADDR32_DUMMY_SDATA(0x0C, addr, 8, pdat, cnt);
  267   2              
  268   2              datalen -= cnt;
  269   2              addr += cnt;
  270   2              pdat += cnt;
  271   2          }
  272   1      }
  273          
  274          void W25Q_DMA_FastRead_Addr32_0C(DWORD addr, BYTE *pdat, WORD datalen)
  275          {
  276   1          QSPI_DMA_READ_INSTR_SADDR32_DUMMY_SDATA(0x0C, addr, 8, pdat, datalen);
  277   1      }
  278          
  279          void W25Q_FastRead_3B(DWORD addr, BYTE *pdat, WORD datalen)
  280          {
  281   1          BYTE cnt;
  282   1          
  283   1          while (datalen > 0)
  284   1          {
  285   2              cnt = 32;
  286   2              if (datalen < 32)
  287   2                  cnt = datalen;
  288   2                  
  289   2              QSPI_READ_INSTR_SADDR24_DUMMY_DDATA(0x3b, addr, 8, pdat, cnt);
  290   2              
  291   2              datalen -= cnt;
  292   2              addr += cnt;
  293   2              pdat += cnt;
  294   2          }
  295   1      }
  296          
  297          void W25Q_DMA_FastRead_3B(DWORD addr, BYTE *pdat, WORD datalen)
  298          {
  299   1          QSPI_DMA_READ_INSTR_SADDR24_DUMMY_DDATA(0x3b, addr, 8, pdat, datalen);
  300   1      }
  301          
  302          void W25Q_FastRead_Addr32_3C(DWORD addr, BYTE *pdat, WORD datalen)
  303          {
  304   1          BYTE cnt;
  305   1          
  306   1          while (datalen > 0)
  307   1          {
  308   2              cnt = 32;
  309   2              if (datalen < 32)
  310   2                  cnt = datalen;
  311   2                  
  312   2              QSPI_READ_INSTR_SADDR32_DUMMY_DDATA(0x3c, addr, 8, pdat, cnt);
  313   2              
  314   2              datalen -= cnt;
  315   2              addr += cnt;
  316   2              pdat += cnt;
  317   2          }
  318   1      }
  319          
  320          void W25Q_DMA_FastRead_Addr32_3C(DWORD addr, BYTE *pdat, WORD datalen)
  321          {
C251 COMPILER V5.60.0,  w25qxx                                                             06/05/25  18:53:49  PAGE 6   

  322   1          QSPI_DMA_READ_INSTR_SADDR32_DUMMY_DDATA(0x3c, addr, 8, pdat, datalen);
  323   1      }
  324          
  325          void W25Q_FastRead_6B(DWORD addr, BYTE *pdat, WORD datalen)
  326          {
  327   1          BYTE cnt;
  328   1          
  329   1          while (datalen > 0)
  330   1          {
  331   2              cnt = 32;
  332   2              if (datalen < 32)
  333   2                  cnt = datalen;
  334   2                  
  335   2              QSPI_READ_INSTR_SADDR24_DUMMY_QDATA(0x6b, addr, 8, pdat, cnt);
  336   2              
  337   2              datalen -= cnt;
  338   2              addr += cnt;
  339   2              pdat += cnt;
  340   2          }
  341   1      }
  342          
  343          void W25Q_DMA_FastRead_6B(DWORD addr, BYTE *pdat, WORD datalen)
  344          {
  345   1          QSPI_DMA_READ_INSTR_SADDR24_DUMMY_QDATA(0x6b, addr, 8, pdat, datalen);
  346   1      }
  347          
  348          void W25Q_FastRead_Addr32_6C(DWORD addr, BYTE *pdat, WORD datalen)
  349          {
  350   1          BYTE cnt;
  351   1          
  352   1          while (datalen > 0)
  353   1          {
  354   2              cnt = 32;
  355   2              if (datalen < 32)
  356   2                  cnt = datalen;
  357   2                  
  358   2              QSPI_READ_INSTR_SADDR32_DUMMY_QDATA(0x6c, addr, 8, pdat, cnt);
  359   2              
  360   2              datalen -= cnt;
  361   2              addr += cnt;
  362   2              pdat += cnt;
  363   2          }
  364   1      }
  365          
  366          void W25Q_DMA_FastRead_Addr32_6C(DWORD addr, BYTE *pdat, WORD datalen)
  367          {
  368   1          QSPI_DMA_READ_INSTR_SADDR32_DUMMY_QDATA(0x6c, addr, 8, pdat, datalen);
  369   1      }
  370          
  371          void W25Q_FastRead_BB(DWORD addr, BYTE *pdat, WORD datalen)
  372          {
  373   1          BYTE cnt;
  374   1          
  375   1          while (datalen > 0)
  376   1          {
  377   2              cnt = 32;
  378   2              if (datalen < 32)
  379   2                  cnt = datalen;
  380   2                  
  381   2              QSPI_READ_INSTR_DADDR24_DALT8_DDATA(0xbb, addr, 0x00, pdat, cnt);
  382   2              
  383   2              datalen -= cnt;
  384   2              addr += cnt;
  385   2              pdat += cnt;
  386   2          }
  387   1      }
C251 COMPILER V5.60.0,  w25qxx                                                             06/05/25  18:53:49  PAGE 7   

  388          
  389          void W25Q_DMA_FastRead_BB(DWORD addr, BYTE *pdat, WORD datalen)
  390          {
  391   1          QSPI_DMA_READ_INSTR_DADDR24_DALT8_DDATA(0xbb, addr, 0x00, pdat, datalen);
  392   1      }
  393          
  394          void W25Q_FastRead_Addr32_BC(DWORD addr, BYTE *pdat, WORD datalen)
  395          {
  396   1          BYTE cnt;
  397   1          
  398   1          while (datalen > 0)
  399   1          {
  400   2              cnt = 32;
  401   2              if (datalen < 32)
  402   2                  cnt = datalen;
  403   2                  
  404   2              QSPI_READ_INSTR_DADDR32_DALT8_DDATA(0xbc, addr, 0x00, pdat, cnt);
  405   2              
  406   2              datalen -= cnt;
  407   2              addr += cnt;
  408   2              pdat += cnt;
  409   2          }
  410   1      }
  411          
  412          void W25Q_DMA_FastRead_Addr32_BC(DWORD addr, BYTE *pdat, WORD datalen)
  413          {
  414   1          QSPI_DMA_READ_INSTR_DADDR32_DALT8_DDATA(0xbc, addr, 0x00, pdat, datalen);
  415   1      }
  416          
  417          void W25Q_FastRead_EB(DWORD addr, BYTE *pdat, WORD datalen)
  418          {
  419   1          BYTE cnt;
  420   1          
  421   1          while (datalen > 0)
  422   1          {
  423   2              cnt = 32;
  424   2              if (datalen < 32)
  425   2                  cnt = datalen;
  426   2                  
  427   2              QSPI_READ_INSTR_QADDR24_QALT8_DUMMY_QDATA(0xeb, addr, 0x00, 4, pdat, cnt);
  428   2              
  429   2              datalen -= cnt;
  430   2              addr += cnt;
  431   2              pdat += cnt;
  432   2          }
  433   1      }
  434          
  435          void W25Q_DMA_FastRead_EB(DWORD addr, BYTE *pdat, WORD datalen)
  436          {
  437   1          QSPI_DMA_READ_INSTR_QADDR24_QALT8_DUMMY_QDATA(0xeb, addr, 0x00, 4, pdat, datalen);
  438   1      }
  439          
  440          void W25Q_QPI_FastRead_EB(DWORD addr, BYTE *pdat, WORD datalen)
  441          {
  442   1          BYTE cnt;
  443   1          
  444   1          while (datalen > 0)
  445   1          {
  446   2              cnt = 32;
  447   2              if (datalen < 32)
  448   2                  cnt = datalen;
  449   2                  
  450   2              QSPI_READ_QINSTR_QADDR24_QALT8_DUMMY_QDATA(0xeb, addr, 0x00, 0, pdat, cnt);
  451   2              
  452   2              datalen -= cnt;
  453   2              addr += cnt;
C251 COMPILER V5.60.0,  w25qxx                                                             06/05/25  18:53:49  PAGE 8   

  454   2              pdat += cnt;
  455   2          }
  456   1      }
  457          
  458          void W25Q_QPI_DMA_FastRead_EB(DWORD addr, BYTE *pdat, WORD datalen)
  459          {
  460   1          QSPI_DMA_READ_QINSTR_QADDR24_QALT8_DUMMY_QDATA(0xeb, addr, 0x00, 0, pdat, datalen);
  461   1      }
  462          
  463          void W25Q_FastRead_Addr32_EC(DWORD addr, BYTE *pdat, WORD datalen)
  464          {
  465   1          BYTE cnt;
  466   1          
  467   1          while (datalen > 0)
  468   1          {
  469   2              cnt = 32;
  470   2              if (datalen < 32)
  471   2                  cnt = datalen;
  472   2                  
  473   2              QSPI_READ_INSTR_QADDR32_QALT8_DUMMY_QDATA(0xec, addr, 0x00, 4, pdat, cnt);
  474   2              
  475   2              datalen -= cnt;
  476   2              addr += cnt;
  477   2              pdat += cnt;
  478   2          }
  479   1      }
  480          
  481          void W25Q_DMA_FastRead_Addr32_EC(DWORD addr, BYTE *pdat, WORD datalen)
  482          {
  483   1          QSPI_DMA_READ_INSTR_QADDR32_QALT8_DUMMY_QDATA(0xec, addr, 0x00, 4, pdat, datalen);
  484   1      }
  485          
  486          void W25Q_WordRead_E7(DWORD addr, BYTE *pdat, WORD datalen)
  487          {
  488   1          BYTE cnt;
  489   1          
  490   1          while (datalen > 0)
  491   1          {
  492   2              cnt = 32;
  493   2              if (datalen < 32)
  494   2                  cnt = datalen;
  495   2                  
  496   2              QSPI_READ_INSTR_QADDR24_QALT8_DUMMY_QDATA(0xe7, addr, 0x00, 2, pdat, cnt);
  497   2              
  498   2              datalen -= cnt;
  499   2              addr += cnt;
  500   2              pdat += cnt;
  501   2          }
  502   1      }
  503          
  504          void W25Q_DMA_WordRead_E7(DWORD addr, BYTE *pdat, WORD datalen)
  505          {
  506   1          QSPI_DMA_READ_INSTR_QADDR24_QALT8_DUMMY_QDATA(0xe7, addr, 0x00, 2, pdat, datalen);
  507   1      }
  508          
  509          void W25Q_OctalWordRead_E3(DWORD addr, BYTE *pdat, WORD datalen)
  510          {
  511   1          BYTE cnt;
  512   1          
  513   1          while (datalen > 0)
  514   1          {
  515   2              cnt = 32;
  516   2              if (datalen < 32)
  517   2                  cnt = datalen;
  518   2                  
  519   2              QSPI_READ_INSTR_QADDR24_QALT8_DUMMY_QDATA(0xe3, addr, 0x00, 0, pdat, cnt);
C251 COMPILER V5.60.0,  w25qxx                                                             06/05/25  18:53:49  PAGE 9   

  520   2              
  521   2              datalen -= cnt;
  522   2              addr += cnt;
  523   2              pdat += cnt;
  524   2          }
  525   1      }
  526          
  527          void W25Q_DMA_OctalWordRead_E3(DWORD addr, BYTE *pdat, WORD datalen)
  528          {
  529   1          QSPI_DMA_READ_INSTR_QADDR24_QALT8_DUMMY_QDATA(0xe3, addr, 0x00, 0, pdat, datalen);
  530   1      }
  531          
  532          void W25Q_SetBurstWrap_77(BYTE wrap)
  533          {
  534   1          QSPI_WRITE_INSTR_QADDR32(0x77, wrap);
  535   1      }
  536          
  537          void W25Q_PageProgram_02(DWORD addr, BYTE *pdat, WORD datalen)
  538          {
  539   1          BYTE cnt;
  540   1          
  541   1          W25Q_WriteEnable_06();
  542   1          while (datalen > 0)
  543   1          {
  544   2              cnt = 32;
  545   2              if (datalen < 32)
  546   2                  cnt = datalen;
  547   2                  
  548   2              if (cnt + (addr & 0xff) >= 0x100)
  549   2                  cnt = 0x100 - (addr & 0xff);
  550   2                  
  551   2              QSPI_WRITE_INSTR_SADDR24_SDATA(0x02, addr, pdat, cnt);
  552   2              
  553   2              datalen -= cnt;
  554   2              addr += cnt;
  555   2              pdat += cnt;
  556   2              
  557   2              if (datalen > 0)
  558   2              {
  559   3                  W25Q_WaitBusy(100);
  560   3                  W25Q_WriteEnable_06();
  561   3              }
  562   2          }
  563   1          W25Q_WaitBusy(100);
  564   1      }
  565          
  566          void W25Q_DMA_PageProgram_02(DWORD addr, BYTE *pdat, WORD datalen)
  567          {
  568   1          W25Q_WriteEnable_06();
  569   1          QSPI_DMA_WRITE_INSTR_SADDR24_SDATA(0x02, addr, pdat, datalen);
  570   1          W25Q_WaitBusy(100);
  571   1      }
  572          
  573          void W25Q_PageProgram_Addr32_12(DWORD addr, BYTE *pdat, WORD datalen)
  574          {
  575   1          BYTE cnt;
  576   1          
  577   1          W25Q_WriteEnable_06();
  578   1          while (datalen > 0)
  579   1          {
  580   2              cnt = 32;
  581   2              if (datalen < 32)
  582   2                  cnt = datalen;
  583   2                  
  584   2              if (cnt + (addr & 0xff) >= 0x100)
  585   2                  cnt = 0x100 - (addr & 0xff);
C251 COMPILER V5.60.0,  w25qxx                                                             06/05/25  18:53:49  PAGE 10  

  586   2                  
  587   2              QSPI_WRITE_INSTR_SADDR32_SDATA(0x12, addr, pdat, cnt);
  588   2              
  589   2              datalen -= cnt;
  590   2              addr += cnt;
  591   2              pdat += cnt;
  592   2              
  593   2              if (datalen > 0)
  594   2              {
  595   3                  W25Q_WaitBusy(100);
  596   3                  W25Q_WriteEnable_06();
  597   3              }
  598   2          }
  599   1          W25Q_WaitBusy(100);
  600   1      }
  601          
  602          void W25Q_DMA_PageProgram_Addr32_12(DWORD addr, BYTE *pdat, WORD datalen)
  603          {
  604   1          W25Q_WriteEnable_06();
  605   1          QSPI_DMA_WRITE_INSTR_SADDR32_SDATA(0x12, addr, pdat, datalen);
  606   1          W25Q_WaitBusy(100);
  607   1      }
  608          
  609          void W25Q_PageProgram_32(DWORD addr, BYTE *pdat, WORD datalen)
  610          {
  611   1          BYTE cnt;
  612   1          
  613   1          W25Q_WriteEnable_06();
  614   1      
  615   1          while (datalen > 0)
  616   1          {
  617   2              cnt = 32;
  618   2              if (datalen < 32)
  619   2                  cnt = datalen;
  620   2                  
  621   2              if (cnt + (addr & 0xff) >= 0x100)
  622   2                  cnt = 0x100 - (addr & 0xff);
  623   2                  
  624   2              QSPI_WRITE_INSTR_SADDR24_QDATA(0x32, addr, pdat, cnt);
  625   2              
  626   2              datalen -= cnt;
  627   2              addr += cnt;
  628   2              pdat += cnt;
  629   2              
  630   2              if (datalen > 0)
  631   2              {
  632   3                  W25Q_WaitBusy(100);
  633   3                  W25Q_WriteEnable_06();
  634   3              }
  635   2          }
  636   1          W25Q_WaitBusy(100);
  637   1      }
  638          
  639          void W25Q_DMA_PageProgram_32(DWORD addr, BYTE *pdat, WORD datalen)
  640          {
  641   1          W25Q_WriteEnable_06();
  642   1          QSPI_DMA_WRITE_INSTR_SADDR24_QDATA(0x32, addr, pdat, datalen);
  643   1          W25Q_WaitBusy(100);
  644   1      }
  645          
  646          void W25Q_PageProgram_Addr32_34(DWORD addr, BYTE *pdat, WORD datalen)
  647          {
  648   1          BYTE cnt;
  649   1          
  650   1          W25Q_WriteEnable_06();
  651   1          while (datalen > 0)
C251 COMPILER V5.60.0,  w25qxx                                                             06/05/25  18:53:49  PAGE 11  

  652   1          {
  653   2              cnt = 32;
  654   2              if (datalen < 32)
  655   2                  cnt = datalen;
  656   2                  
  657   2              if (cnt + (addr & 0xff) >= 0x100)
  658   2                  cnt = 0x100 - (addr & 0xff);
  659   2                  
  660   2              QSPI_WRITE_INSTR_SADDR32_QDATA(0x34, addr, pdat, cnt);
  661   2              
  662   2              datalen -= cnt;
  663   2              addr += cnt;
  664   2              pdat += cnt;
  665   2              
  666   2              if (datalen > 0)
  667   2              {
  668   3                  W25Q_WaitBusy(100);
  669   3                  W25Q_WriteEnable_06();
  670   3              }
  671   2          }
  672   1          W25Q_WaitBusy(100);
  673   1      }
  674          
  675          void W25Q_DMA_PageProgram_Addr32_34(DWORD addr, BYTE *pdat, WORD datalen)
  676          {
  677   1          W25Q_WriteEnable_06();
  678   1          QSPI_DMA_WRITE_INSTR_SADDR32_QDATA(0x34, addr, pdat, datalen);
  679   1          W25Q_WaitBusy(100);
  680   1      }
  681          
  682          void W25Q_Erase4K_20(DWORD addr, BOOL wait)
  683          {
  684   1          W25Q_WriteEnable_06();
  685   1          QSPI_WRITE_INSTR_SADDR24(0x20, addr);
  686   1          if (wait)
  687   1              W25Q_WaitBusy(100);
  688   1      }
  689          
  690          void W25Q_QPI_Erase4K_20(DWORD addr, BOOL wait)
  691          {
  692   1          W25Q_QPI_WriteEnable_06();
  693   1          QSPI_WRITE_QINSTR_QADDR24(0x20, addr);
  694   1          if (wait)
  695   1              W25Q_WaitBusy(100);
  696   1      }
  697          
  698          void W25Q_Erase4K_Addr32_21(DWORD addr, BOOL wait)
  699          {
  700   1          W25Q_WriteEnable_06();
  701   1          QSPI_WRITE_INSTR_SADDR32(0x21, addr);
  702   1          if (wait)
  703   1              W25Q_WaitBusy(100);
  704   1      }
  705          
  706          void W25Q_Erase32K_52(DWORD addr, BOOL wait)
  707          {
  708   1          W25Q_WriteEnable_06();
  709   1          QSPI_WRITE_INSTR_SADDR24(0x52, addr);
  710   1          if (wait)
  711   1              W25Q_WaitBusy(100);
  712   1      }
  713          
  714          void W25Q_QPI_Erase32K_52(DWORD addr, BOOL wait)
  715          {
  716   1          W25Q_QPI_WriteEnable_06();
  717   1          QSPI_WRITE_QINSTR_QADDR24(0x52, addr);
C251 COMPILER V5.60.0,  w25qxx                                                             06/05/25  18:53:49  PAGE 12  

  718   1          if (wait)
  719   1              W25Q_WaitBusy(100);
  720   1      }
  721          
  722          void W25Q_Erase64K_D8(DWORD addr, BOOL wait)
  723          {
  724   1          W25Q_WriteEnable_06();
  725   1          QSPI_WRITE_INSTR_SADDR24(0xd8, addr);
  726   1          if (wait)
  727   1              W25Q_WaitBusy(100);
  728   1      }
  729          
  730          void W25Q_QPI_Erase64K_D8(DWORD addr, BOOL wait)
  731          {
  732   1          W25Q_QPI_WriteEnable_06();
  733   1          QSPI_WRITE_QINSTR_QADDR24(0xd8, addr);
  734   1          if (wait)
  735   1              W25Q_WaitBusy(100);
  736   1      }
  737          
  738          void W25Q_Erase64K_Addr32_DC(DWORD addr, BOOL wait)
  739          {
  740   1          W25Q_WriteEnable_06();
  741   1          QSPI_WRITE_INSTR_SADDR32(0xdc, addr);
  742   1          if (wait)
  743   1              W25Q_WaitBusy(100);
  744   1      }
  745          
  746          void W25Q_EraseChip_C7(BOOL wait)
  747          {
  748   1          W25Q_WriteEnable_06();
  749   1          QSPI_WRITE_INSTR(0xc7);
  750   1          if (wait)
  751   1              W25Q_WaitBusy(100);
  752   1      }
  753          
  754          void W25Q_QPI_EraseChip_C7(BOOL wait)
  755          {
  756   1          W25Q_QPI_WriteEnable_06();
  757   1          QSPI_WRITE_QINSTR(0xc7);
  758   1          W25Q_QPI_WaitBusy(100);
  759   1          if (wait)
  760   1              W25Q_WaitBusy(100);
  761   1      }
  762          
  763          void W25Q_EraseSuspend_75()
  764          {
  765   1          QSPI_WRITE_INSTR(0x75);
  766   1      }
  767          
  768          void W25Q_QPI_EraseSuspend_75()
  769          {
  770   1          QSPI_WRITE_QINSTR(0x75);
  771   1      }
  772          
  773          void W25Q_EraseResume_7A()
  774          {
  775   1          QSPI_WRITE_INSTR(0x7a);
  776   1      }
  777          
  778          void W25Q_QPI_EraseResume_7A()
  779          {
  780   1          QSPI_WRITE_QINSTR(0x7a);
  781   1      }
  782          
  783          void W25Q_ProgramSuspend_75()
C251 COMPILER V5.60.0,  w25qxx                                                             06/05/25  18:53:49  PAGE 13  

  784          {
  785   1          W25Q_EraseSuspend_75();
  786   1      }
  787          
  788          void W25Q_QPI_ProgramSuspend_75()
  789          {
  790   1          W25Q_QPI_EraseSuspend_75();
  791   1      }
  792          
  793          void W25Q_ProgramResume_7A()
  794          {
  795   1          W25Q_EraseResume_7A();
  796   1      }
  797          
  798          void W25Q_QPI_ProgramResume_7A()
  799          {
  800   1          W25Q_QPI_EraseResume_7A();
  801   1      }
  802          
  803          void W25Q_PowerDown_B9()
  804          {
  805   1          QSPI_WRITE_INSTR(0xb9);
  806   1      }
  807          
  808          void W25Q_QPI_PowerDown_B9()
  809          {
  810   1          QSPI_WRITE_QINSTR(0xb9);
  811   1      }
  812          
  813          void W25Q_ReleasePowerDown_AB()
  814          {
  815   1          QSPI_WRITE_INSTR(0xab);
  816   1      }
  817          
  818          void W25Q_QPI_ReleasePowerDown_AB()
  819          {
  820   1          QSPI_WRITE_QINSTR(0xab);
  821   1      }
  822          
  823          BYTE W25Q_ReadDeviceID_AB()
  824          {
  825   1          BYTE dat;
  826   1      
  827   1          QSPI_READ_INSTR_SADDR24_SDATA(0xab, 0x000000, &dat, 1);
  828   1          
  829   1          return dat;
  830   1      }
  831          
  832          BYTE W25Q_QPI_ReadDeviceID_AB()
  833          {
  834   1          BYTE dat;
  835   1      
  836   1          QSPI_READ_QINSTR_QADDR24_QDATA(0xab, 0x000000, &dat, 1);
  837   1          
  838   1          return dat;
  839   1      }
  840          
  841          WORD W25Q_ReadID_90()
  842          {
  843   1          WORD dat;
  844   1          
  845   1          QSPI_READ_INSTR_SADDR24_SDATA(0x90, 0x000000, (BYTE *)&dat, 2);
  846   1      
  847   1          return dat;
  848   1      }
  849          
C251 COMPILER V5.60.0,  w25qxx                                                             06/05/25  18:53:49  PAGE 14  

  850          WORD W25Q_ReadID_92()
  851          {
  852   1          WORD dat;
  853   1          
  854   1          QSPI_READ_INSTR_DADDR24_DALT8_DDATA(0x92, 0x000000, 0x00, (BYTE *)&dat, 2);
  855   1      
  856   1          return dat;
  857   1      }
  858          
  859          WORD W25Q_ReadID_94()
  860          {
  861   1          WORD dat;
  862   1          
  863   1          QSPI_READ_INSTR_QADDR24_QALT8_DUMMY_QDATA(0x94, 0x000000, 0x00, 4, (BYTE *)&dat, 2);
  864   1      
  865   1          return dat;
  866   1      }
  867          
  868          void W25Q_ReadUniqueID_4B(BYTE *pdat)
  869          {
  870   1          QSPI_READ_INSTR_SADDR32_SDATA(0x4b, 0x00000000, pdat, 8);
  871   1      }
  872          
  873          DWORD W25Q_ReadJEDECID_9F()
  874          {
  875   1          DWORD dat;
  876   1          
  877   1          dat = 0;
  878   1          QSPI_READ_INSTR_SDATA(0x9f, (BYTE *)&dat+1, 3);
  879   1      
  880   1          return dat;
  881   1      }
  882          
  883          DWORD W25Q_QPI_ReadJEDECID_9F()
  884          {
  885   1          DWORD dat;
  886   1          
  887   1          dat = 0;
  888   1          QSPI_READ_QINSTR_QDATA(0x9f, (BYTE *)&dat+1, 3);
  889   1      
  890   1          return dat;
  891   1      }
  892          
  893          void W25Q_ReadSFDP_5A(BYTE addr, BYTE *pdat, WORD datalen)
  894          {
  895   1          BYTE cnt;
  896   1          
  897   1          while (datalen > 0)
  898   1          {
  899   2              cnt = 32;
  900   2              if (datalen < 32)
  901   2                  cnt = datalen;
  902   2                  
  903   2              QSPI_READ_INSTR_SADDR24_DUMMY_SDATA(0x5a, addr, 8, pdat, cnt);
  904   2              
  905   2              datalen -= cnt;
  906   2              addr += cnt;
  907   2              pdat += cnt;
  908   2          }
  909   1      }
  910          
  911          void W25Q_EraseSecurityReg_44(DWORD addr)
  912          {
  913   1          QSPI_WRITE_INSTR_SADDR24(0x44, addr);
  914   1      }
  915          
C251 COMPILER V5.60.0,  w25qxx                                                             06/05/25  18:53:49  PAGE 15  

  916          void W25Q_ProgramSecurityReg_42(DWORD addr, BYTE *pdat, WORD datalen)
  917          {
  918   1          BYTE cnt;
  919   1          
  920   1          W25Q_WriteEnable_06();
  921   1          while (datalen > 0)
  922   1          {
  923   2              cnt = 32;
  924   2              if (datalen < 32)
  925   2                  cnt = datalen;
  926   2                  
  927   2              QSPI_WRITE_INSTR_SADDR24_SDATA(0x42, addr, pdat, cnt);
  928   2              
  929   2              datalen -= cnt;
  930   2              addr += cnt;
  931   2              pdat += cnt;
  932   2              
  933   2              if (datalen > 0)
  934   2              {
  935   3                  W25Q_WaitBusy(100);
  936   3                  W25Q_WriteEnable_06();
  937   3              }
  938   2          }
  939   1          W25Q_WaitBusy(100);
  940   1      }
  941          
  942          void W25Q_ReadSecurityReg_48(DWORD addr, BYTE *pdat, WORD datalen)
  943          {
  944   1          BYTE cnt;
  945   1          
  946   1          while (datalen > 0)
  947   1          {
  948   2              cnt = 32;
  949   2              if (datalen < 32)
  950   2                  cnt = datalen;
  951   2                  
  952   2              QSPI_READ_INSTR_SADDR24_DUMMY_SDATA(0x48, addr, 8, pdat, cnt);
  953   2              
  954   2              datalen -= cnt;
  955   2              addr += cnt;
  956   2              pdat += cnt;
  957   2          }
  958   1      }
  959          
  960          void W25Q_QPI_SetReadParam_C0(BYTE dat)
  961          {
  962   1          QSPI_WRITE_QINSTR_QADDR8(0xc0, dat);
  963   1      }
  964          
  965          void W25Q_QPI_BurstReadWithWrap_0C(DWORD addr, BYTE *pdat, WORD datalen)
  966          {
  967   1          BYTE cnt;
  968   1          
  969   1          while (datalen > 0)
  970   1          {
  971   2              cnt = 32;
  972   2              if (datalen < 32)
  973   2                  cnt = datalen;
  974   2                  
  975   2              QSPI_READ_QINSTR_QADDR24_DUMMY_QDATA(0x0c, addr, 2, pdat, cnt);
  976   2              
  977   2              datalen -= cnt;
  978   2              addr += cnt;
  979   2              pdat += cnt;
  980   2          }
  981   1      }
C251 COMPILER V5.60.0,  w25qxx                                                             06/05/25  18:53:49  PAGE 16  

  982          
  983          void W25Q_EnterQPIMode_38()
  984          {
  985   1          QSPI_WRITE_INSTR(0x38);
  986   1      }
  987          
  988          void W25Q_QPI_ExitQPIMode_FF()
  989          {
  990   1          QSPI_WRITE_QINSTR(0xFF);
  991   1      }
  992          
  993          void W25Q_LockSector_36(DWORD addr)
  994          {
  995   1          QSPI_WRITE_INSTR_SADDR24(0x36, addr);
  996   1      }
  997          
  998          void W25Q_QPI_LockSector_36(DWORD addr)
  999          {
 1000   1          QSPI_WRITE_QINSTR_QADDR24(0x36, addr);
 1001   1      }
 1002          
 1003          void W25Q_UnlockSector_39(DWORD addr)
 1004          {
 1005   1          QSPI_WRITE_INSTR_SADDR24(0x39, addr);
 1006   1      }
 1007          
 1008          void W25Q_QPI_UnlockSector_39(DWORD addr)
 1009          {
 1010   1          QSPI_WRITE_QINSTR_QADDR24(0x39, addr);
 1011   1      }
 1012          
 1013          BYTE W25Q_ReadLockSector_3D(DWORD addr)
 1014          {
 1015   1          BYTE dat;
 1016   1      
 1017   1          QSPI_READ_INSTR_SADDR24_SDATA(0x3d, addr, &dat, 1);
 1018   1          
 1019   1          return dat;
 1020   1      }
 1021          
 1022          BYTE W25Q_QPI_ReadLockSector_3D(DWORD addr)
 1023          {
 1024   1          BYTE dat;
 1025   1      
 1026   1          QSPI_READ_QINSTR_QADDR24_QDATA(0x3d, addr, &dat, 1);
 1027   1          
 1028   1          return dat;
 1029   1      }
 1030          
 1031          void W25Q_LockGlobal_7E()
 1032          {
 1033   1          QSPI_WRITE_INSTR(0x7e);
 1034   1      }
 1035          
 1036          void W25Q_QPI_LockGlobal_7E()
 1037          {
 1038   1          QSPI_WRITE_QINSTR(0x7e);
 1039   1      }
 1040          
 1041          void W25Q_UnlockGlobal_98()
 1042          {
 1043   1          QSPI_WRITE_INSTR(0x98);
 1044   1      }
 1045          
 1046          void W25Q_QPI_UnlockGlobal_98()
 1047          {
C251 COMPILER V5.60.0,  w25qxx                                                             06/05/25  18:53:49  PAGE 17  

 1048   1          QSPI_WRITE_QINSTR(0x98);
 1049   1      }
 1050          
 1051          void W25Q_ResetDevice_66_99()
 1052          {
 1053   1          QSPI_WRITE_INSTR(0x66);
 1054   1          QSPI_WRITE_INSTR(0x99);
 1055   1      }
 1056          
 1057          void W25Q_QPI_ResetDevice_66_99()
 1058          {
 1059   1          QSPI_WRITE_QINSTR(0x66);
 1060   1          QSPI_WRITE_QINSTR(0x99);
 1061   1      }
 1062          
 1063          void W25Q_Enable_QE()
 1064          {
 1065   1          if ((W25Q_ReadJEDECID_9F() & 0xffff00) == 0xef4000)
 1066   1          {
 1067   2              if ((W25Q_ReadSR2_35() & 0x02) == 0)
 1068   2              {
 1069   3                  W25Q_WriteEnableVSR_50();
 1070   3                  if ((W25Q_ReadJEDECID_9F() & 0xffff) == 0x4014)
 1071   3                  {
 1072   4                      W25Q_WriteSR12_01(0x0002);
 1073   4                  }
 1074   3                  else
 1075   3                  {
 1076   4                      W25Q_WriteSR2_31(0x02);
 1077   4                  }
 1078   3              }
 1079   2          }
 1080   1      }
 1081          
 1082          


Module Information          Static   Overlayable
------------------------------------------------
  code size            =      7456     ------
  ecode size           =    ------     ------
  data size            =    ------     ------
  idata size           =    ------     ------
  pdata size           =    ------     ------
  xdata size           =       563     ------
  xdata-const size     =    ------     ------
  edata size           =    ------     ------
  bit size             =        10     ------
  ebit size            =    ------     ------
  bitaddressable size  =    ------     ------
  ebitaddressable size =    ------     ------
  far data size        =    ------     ------
  huge data size       =    ------     ------
  const size           =    ------     ------
  hconst size          =    ------     ------
End of Module Information.


C251 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
